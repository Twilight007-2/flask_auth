# Firebase Firestore Setup Guide

## Prerequisites
1. Firebase project created at https://console.firebase.google.com
2. Service account JSON key file downloaded

## Setup Instructions

### 1. Get Firebase Service Account Key
1. Go to Firebase Console: https://console.firebase.google.com
2. Select your project (or create a new one)
3. Go to Project Settings (gear icon) â†’ Service Accounts
4. Click "Generate new private key"
5. Save the JSON file as `firebase-service-account.json` in the project root

### 2. Set Environment Variable (Optional)
Alternatively, you can set the path to your service account file:
```bash
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/firebase-service-account.json"
```

### 3. Install Dependencies
```bash
pip install -r requirements.txt
```

### 4. Firestore Database Structure

The app uses two collections:

#### `users` Collection
- Document ID: Auto-generated by Firestore
- Fields:
  - `first_name` (string)
  - `last_name` (string)
  - `dob` (string)
  - `mobile` (string)
  - `email` (string) - unique
  - `username` (string) - unique
  - `password` (string) - hashed
  - `is_admin` (boolean)
  - `reported` (boolean)
  - `profile_photo` (string)
  - `gender` (string)
  - `failed_attempts` (number)
  - `lock_until` (timestamp, nullable)
  - `otp` (string, nullable)
  - `otp_expiration` (timestamp, nullable)

#### `tasks` Collection
- Document ID: Auto-generated by Firestore
- Fields:
  - `title` (string)
  - `description` (string)
  - `reward` (string)
  - `status` (string) - "pending", "approved", etc.
  - `created_by` (string) - user document ID
  - `assigned_to` (string, nullable) - user document ID
  - `active_for_user` (boolean)
  - `completed` (boolean)
  - `created_at` (timestamp)

### 5. Firestore Security Rules (Recommended)

Set up security rules in Firebase Console:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Tasks collection
    match /tasks/{taskId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null;
    }
  }
}
```

### 6. Testing

After setup, the app will:
- Automatically initialize Firebase on startup
- Create admin user if it doesn't exist
- Use Firestore for all database operations

## Troubleshooting

### Error: "Firebase initialization failed"
- Check that `firebase-service-account.json` exists in project root
- Or set `GOOGLE_APPLICATION_CREDENTIALS` environment variable
- Verify the JSON file is valid

### Error: "Permission denied"
- Check Firestore security rules
- Ensure service account has proper permissions in Firebase Console

### Data not persisting
- Firestore is cloud-based and persists automatically
- Check Firebase Console to verify data is being saved

